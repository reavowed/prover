@import net.prover.model.{Chapter, HtmlHelper}
@import net.prover.model.entries.Theorem
@import net.prover.model.proof.ProofLine
@import net.prover.model.DisplayContext
@(
  theorem: Theorem,
  chapter: Chapter,
  book: net.prover.model.Book,
  previousOption: Option[net.prover.model.Inference.Entry],
  nextOption: Option[net.prover.model.Inference.Entry],
  usages: Seq[(net.prover.model.Book, Chapter, Seq[Theorem])])(
  implicit displayContext: DisplayContext)
@html.inference("Theorem", theorem, theorem.proof.referenceMap, chapter, book, previousOption, nextOption, usages) {
  <div class="theoremProof">
    <hr/>
    <h4>Proof</h4>
    <table class="table-condensed proofRows">
      @theorem.proof.getLines.map { line =>
        <tr class="proofRow" data-reference="@line.reference.getOrElse("")">
          <td>
            @for(_ <- 1 to line.indentLevel) { &nbsp;&nbsp; }
            @Html(HtmlHelper.format(line.prefix))
            <span class="@line.reference.map("conclusion-" + _).getOrElse("")">@Html(html.expression(line.expression).body.trim())</span>.
          </td>
          @line.inferenceLink.map { inferenceLink =>
            <td>
              <a class="stepInferenceId" href="@{inferenceLink.key.map{case (bk, ck, k) => {s"/books/$bk/$ck/$k"}}}">
                @inferenceLink.name
              </a>
            </td>
          }
        </tr>
      }
    </table>
  </div>
  <script type="text/javascript">
    $(function() {
      $("[data-reference]").each(function() {
        var $this = $(this);
        var escapedReference = _.replace($this.attr("data-reference"), /\./g, "\\.");
        var $premises = $(".highlight-" + escapedReference);
        var $conclusion = $this.find('.conclusion-' + escapedReference);
        $(this)
          .on("mouseenter", function() {
            $premises.addClass("highlightPremise");
            $conclusion.addClass("highlightConclusion");
          })
          .on("mouseleave", function() {
            $premises.removeClass("highlightPremise");
            $conclusion.removeClass("highlightConclusion");
          })
      })
    })
  </script>
}
